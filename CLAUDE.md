# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

RealCare is a Korean real estate care service application that helps users with property transactions. It provides:
- **Contract Care**: AI-powered contract risk analysis using Gemini API
- **Reality Check**: Financial feasibility analysis with Korean LTV/DSR regulations
- **Financial Calculators**: Loan limits, tax calculations (acquisition/transfer), affordability checks
- **Owner Signal**: Anonymous property selling intent registration
- **Smart Move-in**: D-Day based move-in timeline with task management
- **i18n Support**: Korean (default) and English

## Tech Stack

- **Framework**: React 19 + Vite 6 + TypeScript
- **Routing**: TanStack Router v1 (file-based routing)
- **State Management**: TanStack Query v5
- **Forms**: TanStack Form + Zod validation
- **AI**: Google Gemini API (`@google/generative-ai`) with File Search RAG
- **Charts**: Recharts
- **PDF Export**: jsPDF + html2canvas
- **Icons**: lucide-react
- **Styling**: Tailwind CSS v4 (PostCSS build)

## Development Commands

```bash
npm install      # Install dependencies
npm run dev      # Start dev server on port 3000
npm run build    # Production build
npm run preview  # Preview production build
```

## Environment Setup

Create `.env.local` with:
```
GEMINI_API_KEY=your_api_key_here
```

The API key is exposed via Vite's `define` config as `process.env.API_KEY` and `process.env.GEMINI_API_KEY`.

## Architecture

### Directory Structure
```
src/
├── main.tsx                    # React entry with QueryClient + Router setup
├── routeTree.gen.ts            # Auto-generated by TanStack Router plugin
├── routes/                     # File-based routing (TanStack Router)
│   ├── __root.tsx              # Root layout with Navigation
│   ├── index.tsx               # Home page (/)
│   ├── calculators.tsx         # Financial calculators (/calculators)
│   ├── contract.tsx            # Contract analysis (/contract)
│   ├── signals.tsx             # Owner signals (/signals)
│   ├── timeline.tsx            # Smart move-in (/timeline)
│   ├── subscription.tsx        # Subscription info (/subscription)
│   └── settings.tsx            # Settings (/settings)
├── components/
│   ├── layout/Navigation.tsx   # Bottom tab navigation with router links
│   ├── realityCheck/           # Reality check form and results
│   ├── ownerSignal/            # Signal creation and listing
│   └── contract/               # Contract forms and timeline
├── services/
│   ├── gemini/                 # Gemini AI services with RAG
│   │   ├── fileSearchStore.ts  # RAG knowledge store management
│   │   ├── contractAnalysisRAG.ts
│   │   └── financialAdviceRAG.ts
│   ├── ownerSignal/            # Owner signal CRUD
│   └── contract/               # Contract management
├── lib/
│   ├── hooks/                  # Custom hooks (useRealityCheck, useContractAnalysis)
│   ├── utils/                  # Calculators (dsr.ts, taxCalculator.ts, realityScore.ts)
│   ├── constants/              # regulations.ts, partnerServices.ts
│   └── i18n/                   # Translation system (ko/en)
├── stores/                     # localStorage-based stores
│   └── languageStore.ts
└── types/                      # TypeScript interfaces
```

### Key Patterns

**Routing**: TanStack Router with file-based routing. Routes auto-generated in `routeTree.gen.ts` - do not edit manually. Base path is `/real/` for subdirectory deployment.

**State Management**:
- TanStack Query for server state (staleTime: 5min, gcTime: 30min)
- LocalStorage for persistence: `realcare_saved_analyses`, `realcare_my_contracts`, `realcare_favorites`, `realcare_language`

**i18n**: Custom translation system in `src/lib/i18n/`. Use `useTranslation()` hook. Korean is default, English switchable via settings.

## Key Implementation Details

### Korean Real Estate Regulations (`src/lib/constants/regulations.ts`)
Region-specific LTV limits by zone classification:
- Speculative zones (Gangnam, Seocho, Songpa): 50% first-home, 30% 1-house, 0% 2+
- Adjusted zones (Mapo, Seongdong): 70% first-home, 60% 1-house, 30% 2+
- Non-regulated: 70% for all

DSR limits: 40% standard, 60% vulnerable groups

### DSR/LTV Calculators (`src/lib/utils/dsr.ts`)
- `calculateDSR()`: Full DSR calculation with existing debt breakdown
- `calculateMaxLoan()`: Max loan given DSR constraints
- `calculateMonthlyPayment()`: Amortization formula (amortizing/interest-only/bullet)

### Reality Score (`src/lib/utils/realityScore.ts`)
Composite score (0-100) based on LTV headroom, DSR utilization, cash gap, income stability

### Gemini RAG Integration (`src/services/gemini/`)
Three knowledge stores for RAG:
- `regulations`: Korean real estate LTV/DSR rules, tax laws
- `contracts`: Standard contract templates, clause analysis
- `precedents`: Legal precedents and dispute resolutions

## Path Alias

`@` is aliased to `src/` (configured in `vite.config.ts` and `tsconfig.json`).

## Development Specifications

Located in `.specs/` following GitHub Spec-Kit methodology. See `.specs/tasks.md` for consolidated implementation task list organized by phase.

## Legacy Code

Root-level files (`App.tsx`, `index.tsx`, `pages/`, `components/Navigation.tsx`, `services/geminiService.ts`) are legacy from pre-TanStack migration. The active codebase is in `src/`.
